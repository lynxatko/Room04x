<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Signal</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#050913;
  --mint:#7aff6b;
  --rose:#ff6fb6;
  --sep:#8fd7ff;
}

/* base */
html,body{margin:0;height:100%;background:var(--bg);font-family:"VT323",monospace;color:var(--mint);overflow:hidden}
body{opacity:0;animation:fadeIn 1.2s ease forwards}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* sky */
#stars{position:fixed;inset:0;width:100%;height:100%;z-index:0;display:block}
.grain{
  position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.06;mix-blend-mode:screen;
  background-image:url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64">\
<filter id="g"><feTurbulence baseFrequency="0.85" numOctaves="1" seed="2"/><feColorMatrix type="saturate" values="0"/></filter>\
<rect width="100%" height="100%" filter="url(%23g)" opacity="0.45"/></svg>');
}

/* layout */
main{position:relative;z-index:1;min-height:100dvh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:28px;text-align:center;padding:24px}

/* aura – měkký závoj */
.aura{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:min(100vw,1100px);height:min(58vh,460px);
  background:radial-gradient(65% 65% at 50% 55%, rgba(60,110,160,.18), rgba(60,110,160,0) 72%);
  filter:blur(36px);mix-blend-mode:screen;opacity:.38;z-index:0;pointer-events:none;
}

/* countdown */
.crt-countdown{position:relative;display:flex;align-items:flex-end;gap:min(2vw,18px);justify-content:center;letter-spacing:.06em;filter:drop-shadow(0 0 10px rgba(122,255,107,.18))}
.crt-countdown::before{
  content:"";position:absolute;left:50%;transform:translateX(-50%);
  width:min(100vw,1100px);height:min(46vh,380px);
  background:radial-gradient(62% 62% at 50% 55%, rgba(30,60,90,.20), rgba(30,60,90,0) 75%);
  filter:blur(28px);z-index:-1;pointer-events:none;opacity:.12;
}
.crt-col{display:flex;flex-direction:column;align-items:center}
.crt-val{
  font-size:clamp(42px,7.2vw,82px);line-height:1;color:var(--mint);
  text-shadow:0 0 6px rgba(122,255,107,.20),0 0 14px rgba(122,255,107,.12);
  position:relative;
}

/* jemné scanlines */
.crt-val::after{
  content:"";position:absolute;inset:-6px -10px;
  background:repeating-linear-gradient(to bottom,rgba(255,255,255,.035) 0px,rgba(255,255,255,0) 2px,rgba(0,0,0,0) 3px);
  mix-blend-mode:overlay;pointer-events:none;opacity:.12;animation:scan 9s linear infinite
}
@keyframes scan{0%{transform:translateY(-4px)}100%{transform:translateY(4px)}}

.crt-sep{font-size:clamp(28px,5vw,56px);margin:0 .1em .16em;color:var(--sep);opacity:.55;transform:translateY(4px)}

/* mini glitch při přechodu sekund – styl jak máš teď */
.crt-val.glitch{
  text-shadow:
    0.5px 0 0 rgba(0,255,255,.38),
   -0.5px 0 0 rgba(255,0,128,.38),
    0 0 8px rgba(122,255,107,.22);
  animation:digit-glow 120ms steps(2,end);
}
@keyframes digit-glow{
  0%{transform:translate(0,0)}
  30%{transform:translate(1px,0)}
  60%{transform:translate(-1px,0)}
  100%{transform:translate(0,0)}
}

/* signal */
.signal{
  color:var(--rose);
  font-size:clamp(20px,3vw,26px);
  letter-spacing:.02em;
  text-shadow:0 0 10px rgba(255,111,182,.28);
  position:relative;display:inline-block;
}

/* transmission – rychlejší + retro typewriter */
.transmission{
  margin-top:8px;
  font-size:clamp(13px,1.7vw,16px);
  letter-spacing:.08em;
  color:rgba(122,255,107,.94);
  text-shadow:0 0 8px rgba(122,255,107,.24);
  opacity:0;
  transition:opacity .4s ease-out;
}
.line1,.line2{
  display:inline-block;
  white-space:pre-wrap;
}

/* heartbeat pro MS */
#ms{animation:ms-breathe 2.2s ease-in-out infinite}
@keyframes ms-breathe{50%{transform:translateY(-0.5px) scale(1.02);opacity:.92}}
#ms.beat{animation:ms-beat .18s ease-out}
@keyframes ms-beat{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}

/* reduced motion */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important;transition:none !important}
  .crt-val::after{display:none}
}
</style>
</head>
<body>

<canvas id="stars"></canvas>
<div class="grain"></div>

<main>
  <div class="aura" aria-hidden="true"></div>

  <section class="crt-countdown" aria-label="countdown">
    <div class="crt-col"><span id="d" class="crt-val">070</span></div>
    <span class="crt-sep">:</span>
    <div class="crt-col"><span id="h" class="crt-val">00</span></div>
    <span class="crt-sep">:</span>
    <div class="crt-col"><span id="m" class="crt-val">00</span></div>
    <span class="crt-sep">:</span>
    <div class="crt-col"><span id="s" class="crt-val">00</span></div>
    <span class="crt-sep">:</span>
    <div class="crt-col"><span id="ms" class="crt-val">000</span></div>
  </section>

  <div id="signal" class="signal">The signal is forming</div>

  <div class="transmission" id="transmission">
    <span class="line1" id="line1">⌁ time bends at the edge of the signal</span><br>
    <span class="line2" id="line2">they are almost through</span>
  </div>
</main>

<script>
const $ = (id)=>document.getElementById(id);

/* hvězdy */
(function(){
  const DPR=Math.max(1,Math.min(2,devicePixelRatio||1));
  const cvs=$("stars"), ctx=cvs.getContext("2d");
  let W=0,H=0;const stars=[];const DENSITY=0.0008,MIN_DIST=12,BASE_MIN=0.4,BASE_MAX=0.9;
  const rnd=(a,b)=>Math.random()*(b-a)+a;
  function resize(){
    W=cvs.clientWidth;H=cvs.clientHeight;
    cvs.width=Math.floor(W*DPR);cvs.height=Math.floor(H*DPR);
    ctx.setTransform(1,0,0,1,0,0);ctx.scale(DPR,DPR);
    init();
  }
  function far(x,y){
    for(const s of stars){
      const dx=x-s.x,dy=y-s.y;
      if(dx*dx+dy*dy<MIN_DIST*MIN_DIST)return false;
    }
    return true;
  }
  function init(){
    stars.length=0;
    const t=Math.round(W*H*DENSITY/DPR);
    let n=0,max=t*20;
    while(stars.length<t&&n<max){
      n++;
      const x=rnd(0,W),y=rnd(0,H);
      if(!far(x,y))continue;
      stars.push({x,y,r:rnd(0.35,2),a:rnd(BASE_MIN,BASE_MAX),tw:rnd(0.001,0.002)});
    }
  }
  function frame(t){
    const time=t*0.001;
    ctx.clearRect(0,0,W,H);
    for(const s of stars){
      const a=s.a+Math.sin(time*2*Math.PI*s.tw)*0.08;
      ctx.fillStyle=`rgba(230,242,255,${a*0.85})`;
      ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();
    }
    requestAnimationFrame(frame);
  }
  resize();
  addEventListener("resize",resize,{passive:true});
  requestAnimationFrame(frame);
})();

/* rotující spodní věta – náhodně při načtení */
const SIGNAL_LINES=[
  "they are almost through",
  "don’t look away now",
  "something is learning how to speak",
  "stay on this bandwidth",
  "you’re bleeding into their time",
  "hold still",
  "something on the other side is counting with you ;)",
  "they think you’re one of them now <3",
  "it sounds human because it learned from you"
];
(function(){
  $("line2").textContent = SIGNAL_LINES[Math.floor(Math.random()*SIGNAL_LINES.length)];
})();

/* countdown */
(function(){
  const end=new Date(new Date().getFullYear(),11,31,23,59,59,999);
  const d=$("d"),h=$("h"),m=$("m"),s=$("s"),ms=$("ms");
  const digits=[d,h,m,s,ms]; // glitch přes všechna čísla
  const pad2=n=>n.toString().padStart(2,'0'),pad3=n=>n.toString().padStart(3,'0');
  let lastSec=-1;
  function tick(){
    const t=Math.max(0,end-new Date());
    const D=Math.floor(t/86400000),
          H=Math.floor((t%86400000)/3600000),
          M=Math.floor((t%3600000)/60000),
          S=Math.floor((t%60000)/1000),
          MS=Math.floor(t%1000);
    d.textContent=pad3(D);
    h.textContent=pad2(H);
    m.textContent=pad2(M);
    s.textContent=pad2(S);
    ms.textContent=pad3(MS);
    if(S!==lastSec){
      lastSec=S;
      ms.classList.add('beat');
      digits.forEach(el=>el.classList.add('glitch'));
      setTimeout(()=>{
        ms.classList.remove('beat');
        digits.forEach(el=>el.classList.remove('glitch'));
      },160);
    }
  }
  setInterval(tick,34);
  tick();
})();

/* rychlejší retro reveal – typewriter efekt pro oba řádky */
(function(){
  const transmission = $("transmission");
  const line1El = $("line1");
  const line2El = $("line2");

  const text1 = line1El.textContent;
  const text2 = line2El.textContent;

  line1El.textContent = "";
  line2El.textContent = "";

  const TYPE_SPEED = 38;   // ms na znak (můžeš klidně snížit na 28, kdyby to mělo být ještě rychlejší)
  const GAP_BETWEEN = 260; // pauza mezi řádkem 1 a 2
  const START_DELAY = 900; // kdy se začne psát od načtení

  function typeText(el,text,idx,done){
    if(idx < text.length){
      el.textContent += text.charAt(idx);
      setTimeout(()=>typeText(el,text,idx+1,done),TYPE_SPEED);
    }else if(done){
      done();
    }
  }

  function startTyping(){
    transmission.style.opacity = "1";
    typeText(line1El,text1,0,()=>{
      setTimeout(()=>{
        typeText(line2El,text2,0);
      },GAP_BETWEEN);
    });
  }

  if(document.readyState==="loading"){
    document.addEventListener("DOMContentLoaded",()=>setTimeout(startTyping,START_DELAY));
  }else{
    setTimeout(startTyping,START_DELAY);
  }
})();
</script>
</body>
</html>
